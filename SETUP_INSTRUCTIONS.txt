# Verifiable Stubs - Complete Project Setup Guide

## âœ… Project Complete

Your Flask-based API project is now fully set up with all three microservices integrated into a single application. This is a production-ready backend with proper database setup, API documentation via Swagger UI, and AWS deployment support.

---

## ğŸ“ Project Structure

```
Verifable-Stubs/
â”‚
â”œâ”€â”€ app/                           # Main application package
â”‚   â”œâ”€â”€ __init__.py               # Flask app factory
â”‚   â”œâ”€â”€ models/                   # SQLAlchemy database models
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ doctor.py            # Doctor, Degree, BoardCert, Training, etc.
â”‚   â”‚   â”œâ”€â”€ academic.py          # StudentSeed, AcademicRecord, Rules
â”‚   â”‚   â””â”€â”€ insurance.py         # Medical, Reviewer, Payout, Notification
â”‚   â”‚
â”‚   â”œâ”€â”€ routes/                   # Flask blueprints (API endpoints)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ doctor_onboarding.py # Doctor verification APIs
â”‚   â”‚   â”œâ”€â”€ academic_admission.py # Academic verification APIs
â”‚   â”‚   â””â”€â”€ insurance_claim.py    # Insurance claim APIs
â”‚   â”‚
â”‚   â”œâ”€â”€ schemas/                  # Pydantic validation schemas
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ doctor_schema.py     # Doctor request/response models
â”‚   â”‚   â”œâ”€â”€ academic_schema.py   # Academic request/response models
â”‚   â”‚   â””â”€â”€ insurance_schema.py  # Insurance request/response models
â”‚   â”‚
â”‚   â””â”€â”€ utils/                    # Utility functions
â”‚       â””â”€â”€ __init__.py
â”‚
â”œâ”€â”€ migrations/                    # Alembic database migrations
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ env.py                    # Alembic environment configuration
â”‚   â””â”€â”€ versions/                 # Migration versions
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ 001_initial.py        # Initial database schema
â”‚
â”œâ”€â”€ config.py                     # Flask configuration (Dev, Prod, Test)
â”œâ”€â”€ run.py                        # Application entry point
â”‚
â”œâ”€â”€ requirements.txt              # Python dependencies
â”œâ”€â”€ .env                          # Environment variables (GITIGNORED)
â”œâ”€â”€ .gitignore                    # Git ignore rules
â”‚
â”œâ”€â”€ README.md                     # Project documentation
â”œâ”€â”€ AWS_DEPLOYMENT.md             # AWS deployment guide
â”œâ”€â”€ SETUP_INSTRUCTIONS.txt        # Quick start guide
â”œâ”€â”€ API_EXAMPLES.rest             # API request examples
â”œâ”€â”€ openapi_schema.json           # OpenAPI specification
â”‚
â”œâ”€â”€ Dockerfile                    # Docker containerization
â”œâ”€â”€ docker-compose.yml            # Local PostgreSQL setup
â”‚
â”œâ”€â”€ setup.sh                      # Linux/Mac setup script
â””â”€â”€ setup.bat                     # Windows setup script
```

---

## ğŸš€ Quick Start

### 1. **Windows Setup** (PowerShell)
```powershell
# Run setup script
.\setup.bat

# Activate virtual environment
.\venv\Scripts\Activate.ps1

# Install dependencies
pip install -r requirements.txt

# Create database
# Make sure PostgreSQL is running first
createdb -U postgres verifiable_stubs

# Run migrations
python -m alembic upgrade head

# Start the application
python run.py
```

### 2. **Linux/Mac Setup**
```bash
# Run setup script
chmod +x setup.sh
./setup.sh

# Source virtual environment
source venv/bin/activate

# Create database
createdb -U postgres verifiable_stubs

# Run migrations
python -m alembic upgrade head

# Start the application
python run.py
```

### 3. **Using Docker** (Optional)
```bash
# Start PostgreSQL with Docker Compose
docker-compose up -d

# Update .env with Docker credentials
# DB_HOST=postgres (from docker-compose service name)

# Install and run app
pip install -r requirements.txt
python -m alembic upgrade head
python run.py
```

---

## ğŸ”§ Configuration

### `.env` File (Create & Configure)
```env
# Flask
FLASK_ENV=development
FLASK_DEBUG=True
SECRET_KEY=your-secret-key-here

# Database
DB_USER=postgres
DB_PASSWORD=postgres
DB_HOST=localhost
DB_PORT=5432
DB_NAME=verifiable_stubs
DATABASE_URL=postgresql://postgres:postgres@localhost:5432/verifiable_stubs

# API
API_TITLE=Verifiable Stubs APIs
API_VERSION=1.0.0
```

---

## ğŸ“Š API Endpoints Overview

### **Doctor Onboarding** (`/api/v1/doctors`)
| Method | Endpoint | Purpose |
|--------|----------|---------|
| POST | `/admin/add` | Batch add doctors |
| GET | `/psv/license/status` | Check license status |
| GET | `/psv/degree/info` | Get degree information |
| GET | `/psv/board-cert/info` | Get board certification |
| GET | `/psv/training/info` | Get training info |
| GET | `/psv/employment/info` | Get employment history |
| GET | `/psv/disciplines/check` | Check disciplinary actions |
| GET | `/psv/malpractice/history` | Get malpractice history |
| GET | `/psv/verify` | Generic verification |

### **Academic Admission** (`/api/v1/academic`)
| Method | Endpoint | Purpose |
|--------|----------|---------|
| POST | `/admin/students` | Batch add students |
| POST | `/admin/eligibility-rules` | Add eligibility rules |
| POST | `/admin/merit-rules` | Add merit rules |
| GET | `/verify/roll-number` | Verify by roll number |
| GET | `/verify/certificate` | Verify by certificate |
| GET | `/check-eligibility` | Check program eligibility |
| GET | `/calculate-merit` | Calculate merit score |

### **Insurance Claims** (`/api/v1/insurance`)
| Method | Endpoint | Purpose |
|--------|----------|---------|
| POST | `/admin/medical-enrichment` | Add medical enrichment |
| POST | `/admin/reviewer-request` | Create reviewer request |
| POST | `/admin/payout-request` | Create payout request |
| POST | `/admin/notification` | Send notification |
| POST | `/medical/enrich` | Medical data enrichment |
| POST | `/claims/review` | Review claim |
| POST | `/payout/process` | Process payout |
| POST | `/notification/send` | Send notification |

---

## ğŸ—„ï¸ Database Models

### Doctor Tables
- `doctors` - Main doctor records
- `degrees` - Educational degrees
- `board_certifications` - Board certifications
- `trainings` - Training programs
- `employments` - Employment history
- `disciplinary_actions` - Disciplinary records
- `malpractice_cases` - Malpractice case records

### Academic Tables
- `student_seeds` - Student records
- `academic_records` - Academic performance
- `eligibility_rules` - Eligibility criteria
- `merit_rules` - Merit calculation rules

### Insurance Tables
- `medical_enrichment_requests` - Medical enrichment requests
- `reviewer_requests` - Reviewer assignments
- `payout_requests` - Payout information
- `notification_requests` - Notification logs

---

## ğŸ” Database Migrations

```bash
# Create a new migration
python -m alembic revision --autogenerate -m "description"

# Apply migrations
python -m alembic upgrade head

# Rollback last migration
python -m alembic downgrade -1

# View migration history
python -m alembic history
```

---

## ğŸ“– API Documentation

### Swagger UI
**Access at:** `http://localhost:5000/apidocs/`

- Interactive API documentation
- Test endpoints directly in browser
- View request/response schemas
- Download OpenAPI specification

### REST Client Examples
See [API_EXAMPLES.rest](API_EXAMPLES.rest) for curl/REST examples

---

## ğŸš¢ Deployment Options

### **Option 1: AWS Elastic Beanstalk** (Recommended)
```bash
pip install awsebcli
eb init -p python-3.11 verifiable-stubs
eb create verifiable-stubs-prod
eb deploy
```

### **Option 2: AWS EC2 + RDS**
1. Create RDS PostgreSQL database
2. Launch EC2 instance
3. Install Python, dependencies, run app with Gunicorn

### **Option 3: Docker + ECS**
1. Build Docker image
2. Push to AWS ECR
3. Create ECS task definition
4. Deploy on ECS Fargate

See [AWS_DEPLOYMENT.md](AWS_DEPLOYMENT.md) for detailed instructions.

---

## ğŸ§ª Testing

### Run Health Check
```bash
curl http://localhost:5000/api/v1/health
```

### Add Sample Doctor
```bash
curl -X POST http://localhost:5000/api/v1/doctors/admin/add \
  -H "Content-Type: application/json" \
  -d '[{
    "doctor_id": "DOC001",
    "name": "Dr. John Doe",
    "license_number": "LIC001",
    "license_status": "Active",
    "license_expiry": "2025-12-31",
    "degree": {
      "degree_name": "MBBS",
      "university": "Medical University",
      "year_of_passing": "2015",
      "registration_number": "REG001"
    },
    "board_certifications": [{
      "board_name": "State Board",
      "certificate_number": "CERT001",
      "valid_till": "2026-12-31"
    }],
    "training": [{
      "program_name": "General Medicine",
      "institution": "Hospital",
      "completion_year": "2016"
    }],
    "employment_history": [{
      "employer_name": "City Hospital",
      "role": "Doctor",
      "years": "5"
    }],
    "disciplinary_actions": [],
    "malpractice_cases": []
  }]'
```

---

## ğŸ“¦ Dependencies

### Core Framework
- **Flask** - Web framework
- **Flask-SQLAlchemy** - ORM
- **Flask-CORS** - Cross-origin support
- **Flasgger** - Swagger UI

### Database
- **SQLAlchemy** - SQL toolkit
- **Alembic** - Database migrations
- **psycopg2** - PostgreSQL adapter

### Validation
- **Pydantic** - Data validation

### Deployment
- **Gunicorn** - WSGI server
- **python-dotenv** - Environment variables

---

## ğŸ”‘ Key Features

âœ… **Three Integrated APIs**
- Doctor verification and onboarding
- Academic record processing
- Insurance claim management

âœ… **Database-Backed**
- PostgreSQL with SQLAlchemy ORM
- Alembic migrations for schema management
- Proper relationships and constraints

âœ… **API Documentation**
- Swagger UI auto-generated docs
- OpenAPI specification
- Interactive testing

âœ… **Production Ready**
- Environment-based configuration
- Error handling
- CORS enabled
- Database transactions
- Proper logging support

âœ… **Easy Deployment**
- Docker support
- AWS deployment guide
- Gunicorn ready
- Environment variable support

---

## ğŸ“ Environment Setup for Production

```bash
# Install production dependencies
pip install gunicorn

# Create .env for production
export FLASK_ENV=production
export FLASK_DEBUG=False
export SECRET_KEY=strong-random-key
export DATABASE_URL=postgresql://user:pass@rds-endpoint:5432/verifiable_stubs

# Run with Gunicorn
gunicorn -w 4 -b 0.0.0.0:5000 run:app
```

---

## ğŸ†˜ Troubleshooting

### Database Connection Error
```
Check:
1. PostgreSQL is running
2. .env has correct DATABASE_URL
3. Database exists: createdb -U postgres verifiable_stubs
```

### Module Not Found
```bash
# Ensure virtual environment is activated
source venv/bin/activate  # Linux/Mac
.\venv\Scripts\Activate.ps1  # Windows

# Reinstall requirements
pip install -r requirements.txt
```

### Port Already in Use
```bash
# Change port in run.py or use:
python run.py --port 8000
```

---

## ğŸ“š Documentation Files

- **README.md** - Project overview and basic setup
- **AWS_DEPLOYMENT.md** - Detailed AWS deployment guide
- **API_EXAMPLES.rest** - Example API requests
- **SETUP_INSTRUCTIONS.txt** - Quick start guide
- **config.py** - Configuration management
- **requirements.txt** - Python dependencies

---

## âœ¨ Next Steps

1. âœ… **Setup complete** - All files created
2. ğŸ“¦ **Install dependencies** - Run `pip install -r requirements.txt`
3. ğŸ—„ï¸ **Setup database** - Create PostgreSQL database
4. ğŸš€ **Run migrations** - Execute `python -m alembic upgrade head`
5. â–¶ï¸ **Start the app** - Run `python run.py`
6. ğŸ“– **Test APIs** - Visit `http://localhost:5000/apidocs/`
7. ğŸŒ **Deploy** - Follow AWS_DEPLOYMENT.md for production

---

## ğŸ“ Support

For issues or questions:
- Check API_EXAMPLES.rest for request formats
- Review Swagger documentation at `/apidocs/`
- Check logs for detailed error messages
- Verify .env configuration
- Ensure PostgreSQL is running

---

**Project Setup Completed Successfully! ğŸ‰**

Your Flask API backend is ready for development and deployment.
